#pragma once
#include "head.h"
class pe_action
{
public:
	DWORD64 m_image_base;
	DWORD64 entry_point;
	DWORD file_size;
	PVOID m_buffer;
	DWORD readed_size;
	PIMAGE_NT_HEADERS m_nt_head;
	RtlImageDirectoryEntryToDataFn RtlImageDirectoryEntryToData;
	void map_pe_import(DWORD64 params_moudle_base);
	void relocation(PVOID params_image_base, PIMAGE_NT_HEADERS params_nt_head);
	std::vector<moudle_export> get_export(PVOID params_image_base);
	bool load_pe(std::string parms_file_path);
	void push_to_virtual_helper(std::vector<moudle_export> params_export, std::vector<moudle_import> params_import, char* params_dll_name, uint64_t params_moudle_base);
};
